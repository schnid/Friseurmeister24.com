<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Terminbuchung | Dein Friseursalon</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {--primary:#8b7355;--secondary:#d4af37;--light:#f8f5f0;--dark:#333;--gray:#e0e0e0;--success:#4caf50;--error:#f44336;}
    body {margin:0;font-family:'Segoe UI',sans-serif;background:var(--light);color:var(--dark);}
    header {background:linear-gradient(to right,var(--primary),var(--secondary));padding:1rem;color:white;text-align:center;}
    .container {max-width:900px;margin:auto;padding:1rem;}
    .step {display:none;}
    .step.active {display:block;animation:fadeIn .3s;}
    @keyframes fadeIn {from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
    .services-grid {display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:1rem;}
    .service-card {border:1px solid var(--gray);padding:1rem;border-radius:8px;cursor:pointer;transition:.3s;}
    .service-card:hover {border-color:var(--primary);transform:translateY(-3px);}
    .service-card.selected {background:rgba(139,115,85,0.1);border-color:var(--primary);}
    button {padding:.7rem 1.2rem;border:none;border-radius:6px;cursor:pointer;font-weight:600;}
    .btn-primary {background:var(--primary);color:white;}
    .btn-primary:disabled {background:var(--gray);cursor:not-allowed;}
    .btn-secondary {background:var(--gray);}
    .dates,.times {display:flex;flex-wrap:wrap;gap:.5rem;}
    .dates button,.times button {flex:1 0 120px;}
    label{display:block;margin:.5rem 0 .2rem;font-weight:600;}
    input,textarea{width:100%;padding:.5rem;border:1px solid var(--gray);border-radius:5px;}
    .error{color:var(--error);font-size:.9rem;display:none;}
    .confirmation {text-align:center;padding:2rem;background:rgba(76,175,80,0.1);border-radius:10px;}
    .confirmation i {font-size:3rem;color:var(--success);}
    footer {background:var(--dark);color:white;text-align:center;padding:1rem;margin-top:2rem;}
  </style>
</head>
<body>
  <header><h1>Termin online buchen</h1></header>
  <div class="container">

    <!-- Schritt 1 -->
    <div id="step1" class="step active">
      <h2>1. Service auswählen</h2>
      <div class="services-grid" id="services"></div>
      <button class="btn-primary" id="toStep2" disabled>Weiter</button>
    </div>

    <!-- Schritt 2 -->
    <div id="step2" class="step">
      <h2>2. Datum auswählen</h2>
      <div class="dates" id="dates"></div>
      <button class="btn-secondary" onclick="goToStep(1)">Zurück</button>
      <button class="btn-primary" id="toStep3" disabled>Weiter</button>
    </div>

    <!-- Schritt 3 -->
    <div id="step3" class="step">
      <h2>3. Uhrzeit auswählen</h2>
      <div class="times" id="times"></div>
      <button class="btn-secondary" onclick="goToStep(2)">Zurück</button>
      <button class="btn-primary" id="toStep4" disabled>Weiter</button>
    </div>

    <!-- Schritt 4 -->
    <div id="step4" class="step">
      <h2>4. Ihre Daten</h2>
      <label for="name">Name *</label>
      <input id="name"><div class="error" id="nameErr">Bitte Name eingeben</div>
      <label for="phone">Telefon *</label>
      <input id="phone"><div class="error" id="phoneErr">Bitte Telefonnummer eingeben</div>
      <label for="email">E-Mail</label><input id="email">
      <label for="notes">Notizen</label><textarea id="notes"></textarea>
      <button class="btn-secondary" onclick="goToStep(3)">Zurück</button>
      <button class="btn-primary" onclick="book()">Termin buchen</button>
    </div>

    <!-- Schritt 5 -->
    <div id="step5" class="step">
      <div class="confirmation">
        <i class="fas fa-check-circle"></i>
        <h2>Termin erfolgreich gebucht!</h2>
        <p>Wir freuen uns auf Ihren Besuch.</p>
      </div>
      <button class="btn-primary" onclick="goToStep(1)">Neuen Termin buchen</button>
    </div>
  </div>

  <footer>&copy; 2025 Dein Friseursalon</footer>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw41Pmg5QqbE5H545jo4RbU-PZXcJTp2YTepbRajAIfN4i3fK7-oQ93g5OItROmo4JY/exec";

    // Alle 16 Services
    const services = [
      {id:1,name:"Maschinenhaarschnitt (Herren)",preis:"11 €",dauer:20},
      {id:2,name:"Trockenschnitt (Herren)",preis:"15 €",dauer:25},
      {id:3,name:"Waschen, Schneiden (Herren)",preis:"17 €",dauer:30},
      {id:4,name:"Waschen, Schneiden, Föhnen (Herren)",preis:"19,50 €",dauer:35},
      {id:5,name:"Trockenschnitt (Damen)",preis:"19 €",dauer:30},
      {id:6,name:"Waschen, Schneiden (Damen)",preis:"21 €",dauer:35},
      {id:7,name:"Waschen, Schneiden, Föhnen (kurz)",preis:"23 €",dauer:45},
      {id:8,name:"Waschen, Schneiden, Föhnen (mittel)",preis:"28 €",dauer:60},
      {id:9,name:"Waschen, Schneiden, Föhnen (lang)",preis:"33 €",dauer:90},
      {id:10,name:"Ansatzfarbe",preis:"43 €",dauer:90},
      {id:11,name:"Foliensträhnen XS (bis 15)",preis:"29 €",dauer:60},
      {id:12,name:"Foliensträhnen S (halber Kopf)",preis:"49 €",dauer:90},
      {id:13,name:"Foliensträhnen M (ganzer Kopf)",preis:"69 €",dauer:120},
      {id:14,name:"Tönung",preis:"35 €",dauer:60},
      {id:15,name:"Glossing",preis:"15 €",dauer:20},
      {id:16,name:"Conditioner / Pflege",preis:"+5 €",dauer:10}
    ];

    let selService=null, selDate=null, selTime=null;

    function goToStep(n){
      document.querySelectorAll(".step").forEach(s=>s.classList.remove("active"));
      document.getElementById("step"+n).classList.add("active");
    }

    // Schritt 1
    function renderServices(){
      const c=document.getElementById("services");
      services.forEach(s=>{
        const div=document.createElement("div");
        div.className="service-card";
        div.innerHTML=`<b>${s.name}</b><br>${s.preis} · ${s.dauer} Min`;
        div.onclick=()=>{document.querySelectorAll(".service-card").forEach(x=>x.classList.remove("selected"));div.classList.add("selected");selService=s;document.getElementById("toStep2").disabled=false;};
        c.appendChild(div);
      });
    }

    document.getElementById("toStep2").onclick=async()=>{
      goToStep(2);
      try{
        const r=await fetch(SCRIPT_URL+"?action=getDates");
        const d=await r.json();
        renderDates(d.dates||generateDates());
      }catch{renderDates(generateDates());}
    };

    function renderDates(dates){
      const c=document.getElementById("dates");c.innerHTML="";
      dates.forEach(date=>{
        const d=new Date(date);
        const wd=d.getDay(); // 0=So,1=Mo,...6=Sa
        if([4,5,6].includes(wd)){
          const b=document.createElement("button");
          b.textContent=d.toLocaleDateString("de-DE",{weekday:"long",day:"2-digit",month:"2-digit"});
          b.className="btn-secondary";
          b.onclick=()=>{selDate=d;document.querySelectorAll("#dates button").forEach(x=>x.style.background="");b.style.background="var(--primary)";document.getElementById("toStep3").disabled=false;};
          c.appendChild(b);
        }
      });
    }

    document.getElementById("toStep3").onclick=async()=>{
      goToStep(3);
      try{
        const r=await fetch(SCRIPT_URL+"?action=getTimes&date="+selDate.toISOString().split("T")[0]);
        const d=await r.json();renderTimes(d.times||generateTimes());
      }catch{renderTimes(generateTimes());}
    };

    function renderTimes(times){
      const c=document.getElementById("times");c.innerHTML="";
      times.forEach(t=>{
        const b=document.createElement("button");
        b.textContent=t;b.className="btn-secondary";
        b.onclick=()=>{selTime=t;document.querySelectorAll("#times button").forEach(x=>x.style.background="");b.style.background="var(--primary)";document.getElementById("toStep4").disabled=false;};
        c.appendChild(b);
      });
    }

    document.getElementById("toStep4").onclick=()=>goToStep(4);

    async function book(){
      const name=document.getElementById("name").value.trim();
      const phone=document.getElementById("phone").value.trim();
      if(!name){document.getElementById("nameErr").style.display="block";return;}
      if(!phone){document.getElementById("phoneErr").style.display="block";return;}
      const data={action:"bookAppointment",service:selService,date:selDate.toISOString().split("T")[0],time:selTime,name,phone,email:document.getElementById("email").value,notes:document.getElementById("notes").value};
      try{
        const r=await fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)});
        const res=await r.json();
        if(res.success){goToStep(5);}else{alert("Fehler: "+res.message);}
      }catch{alert("Netzwerkfehler. Bitte später erneut versuchen.");}
    }

    function generateDates(){const a=[];for(let i=1;i<=14;i++){const d=new Date();d.setDate(d.getDate()+i);a.push(d.toISOString().split("T")[0]);}return a;}
    function generateTimes(){return ["12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30"];} // Fallback

    renderServices();
  </script>
</body>
</html>
